<!DOCTYPE html>
<html>
<head>
  <title>JavaScript</title>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/processing.js/1.4.8/processing.min.js"></script>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script>
    var canvas = document.getElementById("canvas");
    var processing = new Processing(canvas, function(processing) {
        processing.size(400, 400);
        processing.background(0xFFF);

        var mouseIsPressed = false;
        processing.mousePressed = function () { mouseIsPressed = true; };
        processing.mouseReleased = function () { mouseIsPressed = false; };

        var keyIsPressed = false;
        processing.keyPressed = function () { keyIsPressed = true; };
        processing.keyReleased = function () { keyIsPressed = false; };

        function getImage(s) {
            var url = "https://www.kasandbox.org/programming-images/" + s + ".png";
            processing.externals.sketch.imageCache.add(url);
            return processing.loadImage(url);
        }

        // use degrees rather than radians in rotate function
        var rotateFn = processing.rotate;
        processing.rotate = function (angle) {
            rotateFn(processing.radians(angle));
        };

        with (processing) {
          var gameScore = 0;
          var gameLevel = 0;
          var buildings = [];
          var keys = [];
          keyPressed = function(){
            keys[keyCode] = true;
          };
          keyReleased = function(){
            delete keys[keyCode];
          };

          var airPlane = function(x,y,w,h,speed){
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.speed = speed;
          };
          airPlane.prototype.draw = function() {
              image(getImage("space/octopus"),this.x, this.y, this.w, this.h);
          };
          airPlane.prototype.move = function(){
            this.x += this.speed;
            if(this.x > width){
             this.x = 0;
             this.y += this.h/2;
            }
          };
          var player = new airPlane(10,10,70,60,2);

          var Bomb = function(x,y,xVel,yVel,w,h,accel){
            this.x = x;
            this.y = y;
            this.xVel = xVel;
            this.yVel = yVel;
            this.w = w;
            this.h = h;
            this.accel = accel;
          };
          Bomb.prototype.draw = function() {
               fill(0, 145, 255);
               noStroke();
               ellipse(this.x, this.y, this.w, this.h);
          };
          Bomb.prototype.drop = function(){
              this.x += this.xVel;
              this.y += this.yVel;
              this.yVel += this.accel;
              if(this.x > width){
               this.x = 0;
              }
          };
          var bomb = new Bomb (100,height + 10, 2, 0, 20,10, 0.2);
          var dropBomb = function(bomb,player){
            bomb.x = player.x + player.w/2;
            bomb.y = player.y + player.h;
            bomb.xVel = player.speed;
            bomb.yVel = 0;
            bomb.accel = 0.2;
            gameScore --;
          };

          var Building = function(x,y,w,h,color){
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.color = color;
          };
          Building.prototype.draw = function() {
              fill(this.color);
              rect(this.x, this.y, this.w, this.h);
          };
          Building.prototype.shrink = function(){
            this.h -= 20;
          };
          var hitBox = function(a,b){
              return(a.x <= b.x + b.w &&
                     b.x <= a.x + a.w &&
                     a.y <= b.y + b.h &&
                     b.y <= a.y + a.h);
          };

          var checkforCollisons = function(bomb, Building){
            for(var i in buildings){
              if(hitBox(bomb,buildings[i])){
                  //move bomb off screen
               bomb.y = height + 100;
               fill(255, 0, 0);
               ellipse(bomb.x, bomb.y, bomb.w*2, bomb.h*2);
               buildings[i].h = buildings[i].h - 30;
               buildings[i].y = buildings[i].y + 30;

               //check to see if building destroyed
               if(buildings[i].h < 0){
                gameScore += 10;
               }
              }
            }
          };

          var buildBuildings = function(){
            gameLevel ++;
            player.xVel = gameLevel;

            var numberofBuildings = gameLevel;
            if(numberofBuildings > 5){
              numberofBuildings = 5;
            }
            for(var i = 0; i < numberofBuildings; i++){
              var w = 100 - gameLevel * 10;
                  if(w < 20){
                       w = 20;
                          }
              var x = random(5, width - w);
              var y = random(200,350);

            buildings[i] = new Building(x,y,w,height - y,color(random(0,255),random(0,255),random(0,255)));

            }


          };

          buildBuildings();
          player.y = 10;
          draw = function() {
              background(61, 187, 209);
              player.draw();
              player.move();
              bomb.draw();
              bomb.drop();
              if(keys[DOWN] && bomb.y > height){
               dropBomb(bomb,player,gameScore);
              }
             for(var i in buildings){
              buildings[i].draw();
             }
             checkforCollisons (bomb,Building);
             fill(255, 0, 0);
             text("Score: " + gameScore, 20,46);
          };

            // INSERT YOUR KHAN ACADEMY PROGRAM HERE


        }
        if (typeof draw !== 'undefined') processing.draw = draw;
    });
  </script>
</body>
</html>
